package de.marko.pentest.rest.handler;

import de.marko.pentest.Dummy;
import de.marko.pentest.parser.ObjectParser;
import io.vertx.core.Handler;
import io.vertx.ext.web.RoutingContext;
import java.io.IOException;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * @author marko
 * @version 1.0.0.
 * @date 19.08.2017
 */
public class JacksonHandler implements Handler<RoutingContext> {

	private final static Logger LOGGER = LoggerFactory.getLogger(JacksonHandler.class);

	@Override
	public void handle(RoutingContext routingContext) {

		routingContext.request().bodyHandler(buffer -> {

			String body = buffer.toString();

			try {
				ObjectParser parser = new ObjectParser();

				Dummy dummy = (Dummy) parser.parseJackson(Object.class, body);

				LOGGER.debug("JSON Request read: " + dummy.getId());

			} catch (IOException e) {
				routingContext.response().setStatusCode(400).end(e.getLocalizedMessage());
			}

		});
		if (!routingContext.response().ended()) {
			routingContext.response().setStatusCode(200).end("success");
		}
	}


}
