package de.marko.pentest.rest.handler;

import de.marko.pentest.Dummy;
import io.vertx.core.Handler;
import io.vertx.core.json.DecodeException;
import io.vertx.core.json.Json;
import io.vertx.ext.web.RoutingContext;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * @author marko
 * @version 1.0.0.
 * @date 30.08.2017
 */
public class VertxJsonHandler implements Handler<RoutingContext> {

	private final static Logger LOGGER = LoggerFactory.getLogger(VertxJsonHandler.class);

	@Override
	public void handle(RoutingContext routingContext) {

		routingContext.request().bodyHandler(buffer -> {

			String body = buffer.toString();

			try {
				Dummy dummy = Json.decodeValue(body, Dummy.class);

				LOGGER.debug("JSON Request read: " + dummy.getId());

			} catch (DecodeException e) {
				routingContext.response().setStatusCode(400).end(e.getLocalizedMessage());
			}
		});

		if (!routingContext.response().ended()) {
			routingContext.response().setStatusCode(200).end("success");
		}

	}
}
