package de.marko.pentest.rest.handler;

import de.marko.pentest.db.DatabaseJPAConnector;
import de.marko.pentest.db.entity.User;
import io.vertx.core.Handler;
import io.vertx.ext.web.RoutingContext;

/**
 * @author marko
 * @version 1.0.0.
 * @date 05.01.2018
 */
public class GetTokenHandlerV1 implements Handler<RoutingContext> {

	@Override
	public void handle(RoutingContext routingContext) {

		String name = routingContext.request().getParam("name");

		String password = routingContext.request().getParam("password");

		String query = "SELECT u.id, u.name, u.password, u.token, u.version"
			+ " FROM Users u"
			+ " WHERE name = '" + name
			+ "' AND password = '" + password + "'";

		User user = DatabaseJPAConnector.connect()
			.nativeSelectQuery(query, User.class)
			.stream()
			.findFirst()
			.orElse(null);

		if (user != null) {
			routingContext.response().setStatusCode(200).end(user.getToken());
		} else {
			routingContext.response().setStatusCode(500).end("");
		}
	}

}
